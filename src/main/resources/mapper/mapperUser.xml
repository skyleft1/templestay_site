<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.mapperUser">
    
    <select id="login" parameterType="ModelUser" resultType="ModelUser">
            select userid, userpassword, username,  useremail, phonenumber, address,  joindate 
              from TB_USER
             WHERE  userid = #{userid}
              AND userpassword = #{userpassword}
    </select>
    
    <select id="getUserName" parameterType="string" resultType="string">        
        SELECT username
          FROM TB_user
         WHERE userid = #{userid}
    </select>
    
    <select id="getUserOne" parameterType="string" resultType="ModelUser">
        SELECT userid, userpassword, username, useremail, phonenumber, address,  joindate 
          FROM TB_User 
         WHERE userid = #{userid}
    </select>
    
    <select id="getUserList" resultType="ModelUser">
        SELECT userno, userid, userpassword, username, useremail, phonenumber, address,  joindate 
          FROM TB_User
        ORDER BY username
    </select>         
        
    <insert id="insertUser" parameterType="ModelUser">
        INSERT INTO 
        TB_User ( userid, userpassword, username, useremail, phonenumber, address,  joindate   )
        VALUES ( #{userid}, #{userpassword}, #{username}, #{useremail}, #{phonenumber} , #{address} , now() )
    </insert>
    
    <insert id="insertUserList" parameterType="java.util.List">
        INSERT INTO tb_User( userid, userpassword, username, useremail, phonenumber , address , joindate )
        VALUES
            <foreach collection="list" item="item" index="index" open="(" separator="),(" close=")">
                #{item.userid} , #{item.userpassword} , #{item.username}, #{item.useremail} , #{item.phonenumber} , #{item.address}  , now() }
            </foreach>
    </insert>
    
    
    
    <update id="updatePassword" parameterType="hashmap" >
            UPDATE TB_USER 
               SET userpassword = #{newpassword}            
             WHERE userpassword = #{currentpassword} AND userid = #{userid}
    </update>
    
    <update id="updateUser" parameterType="hashmap">
        UPDATE TB_User 
            SET userid   = #{updateValue.userid}
              , username = #{updateValue.username}
              , useremail  = #{updateValue.useremail}
              , phonenumber  = #{updateValue.phonenumber}
              , address  = #{updateValue.address}
            WHERE 1 = 1 
              <if test="searchValue.userno != null and searchValue.userno != ''" >
              AND userno    = #{searchValue.userno}
              </if>
              <if test="searchValue.userid != null and searchValue.userid != ''" >
              AND userid    = #{searchValue.userid}
              </if>
              <if test="searchValue.username != null and searchValue.username != ''">
              AND username  = #{searchValue.username}
              </if>

    </update>
    
    <delete id="deleteUser" parameterType="ModelUser">
        DELETE FROM TB_User 
         WHERE 1 = 1 
          <if test="userno != null and userno != ''" >
          AND userno  = #{userno}
          </if>
          <if test="userid != null and userid != ''" >
          AND userid  = #{userid}
          </if>
          <if test="username != null and username != ''" >
          AND username  = #{username}
          </if>
    </delete>

    <select id="checkuserid" parameterType="string" resultType="int">
            SELECT count(userid)
            FROM TB_USER
            where userid = #{userid}
    </select>

 </mapper>
